(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{83:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return i})),a.d(t,"metadata",(function(){return o})),a.d(t,"rightToc",(function(){return l})),a.d(t,"default",(function(){return d}));var r=a(3),n=a(7),s=(a(0),a(92)),i={id:"forgot-password-process",title:"Forgot password process",sidebar_label:"Forgot password process"},o={unversionedId:"forgot-password-process",id:"forgot-password-process",isDocsHomePage:!1,title:"Forgot password process",description:"Linz has the capability to support a forgot password process. It can be used to allow the user to reset their password.",source:"@site/docs/forgot-password-process.md",slug:"/forgot-password-process",permalink:"/linz/docs/forgot-password-process",editUrl:"https://github.com/linzjs/linz/tree/master/docusaurus/docs/forgot-password-process.md",version:"current",sidebar_label:"Forgot password process",sidebar:"sidebar",previous:{title:"Cell renderers",permalink:"/linz/docs/cell-renderers"},next:{title:"Security",permalink:"/linz/docs/security"}},l=[{value:"Send a password reset email",id:"send-a-password-reset-email",children:[{value:"The <code>sendPasswordResetEmail</code> static",id:"the-sendpasswordresetemail-static",children:[]},{value:"Retrieving a user record based on an email address",id:"retrieving-a-user-record-based-on-an-email-address",children:[]},{value:"Genearing a unique hash for the user record",id:"genearing-a-unique-hash-for-the-user-record",children:[]},{value:"Creating a link to verify email address ownership",id:"creating-a-link-to-verify-email-address-ownership",children:[]},{value:"Send an email",id:"send-an-email",children:[]}]},{value:"Verifying ownership of the email address",id:"verifying-ownership-of-the-email-address",children:[]},{value:"Updating the users password",id:"updating-the-users-password",children:[]}],c={rightToc:l};function d(e){var t=e.components,a=Object(n.a)(e,["components"]);return Object(s.b)("wrapper",Object(r.a)({},c,a,{components:t,mdxType:"MDXLayout"}),Object(s.b)("p",null,"Linz has the capability to support a ",Object(s.b)("em",{parentName:"p"},"forgot password")," process. It can be used to allow the user to reset their password."),Object(s.b)("p",null,"If enabled, it will render a ",Object(s.b)("em",{parentName:"p"},"Forgot your password?")," link on the log in page, which will facilitate the ability for a user to reset their password. It uses an email as proof of user record ownership. If the user can access a link sent to an email identified with a user record, then they can reset the password."),Object(s.b)("p",null,"To enable this process, you need to:"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"Have a user model that stores an email address."),Object(s.b)("li",{parentName:"ul"},"Define a ",Object(s.b)("inlineCode",{parentName:"li"},"sendPasswordResetEmail")," ",Object(s.b)("a",Object(r.a)({parentName:"li"},{href:"https://mongoosejs.com/docs/guide.html#statics"}),"Mongoose static")," on your user model."),Object(s.b)("li",{parentName:"ul"},"Define a ",Object(s.b)("inlineCode",{parentName:"li"},"verifyPasswordResetHash")," ",Object(s.b)("a",Object(r.a)({parentName:"li"},{href:"https://mongoosejs.com/docs/guide.html#methods"}),"Mongoose method")," on your user model."),Object(s.b)("li",{parentName:"ul"},"Define an ",Object(s.b)("inlineCode",{parentName:"li"},"updatePassword")," ",Object(s.b)("a",Object(r.a)({parentName:"li"},{href:"https://mongoosejs.com/docs/guide.html#statics"}),"Mongoose static")," on your user model.")),Object(s.b)("p",null,"The process works as follows:"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"User clicks the ",Object(s.b)("em",{parentName:"li"},"Forgot your password?")," link on the log in page."),Object(s.b)("li",{parentName:"ul"},"The user is directed to the ",Object(s.b)("em",{parentName:"li"},"Forgot your password")," page, and prompted to enter their email address."),Object(s.b)("li",{parentName:"ul"},"The ",Object(s.b)("inlineCode",{parentName:"li"},"sendPasswordResetEmail")," static is executed with the email address they provided."),Object(s.b)("li",{parentName:"ul"},"The ",Object(s.b)("inlineCode",{parentName:"li"},"sendPasswordResetEmail")," static should generate a unique hash for the user, and send an email to the user containing a link to reset their password."),Object(s.b)("li",{parentName:"ul"},"The user will receive the email, and click on the link."),Object(s.b)("li",{parentName:"ul"},"The link will be verified by executing the ",Object(s.b)("inlineCode",{parentName:"li"},"verifyPasswordResetHash")," method."),Object(s.b)("li",{parentName:"ul"},"If the password reset hash can be be verified, the user will be provided the opportunity to enter a new password meeting the conditions of the ",Object(s.b)("inlineCode",{parentName:"li"},"admin password pattern")," setting."),Object(s.b)("li",{parentName:"ul"},"The new password will be provided to the ",Object(s.b)("inlineCode",{parentName:"li"},"updatePassword")," static to store the updated password against the user record.")),Object(s.b)("p",null,"More succintly:"),Object(s.b)("ol",null,Object(s.b)("li",{parentName:"ol"},"Send a password reset email."),Object(s.b)("li",{parentName:"ol"},"Verify ownership of the email."),Object(s.b)("li",{parentName:"ol"},"Collect a new password and update their user record.")),Object(s.b)("h2",{id:"send-a-password-reset-email"},"Send a password reset email"),Object(s.b)("p",null,"This part of the process entails:"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"Retreiving a user record based on an email address."),Object(s.b)("li",{parentName:"ul"},"Generating a unique hash for the user record."),Object(s.b)("li",{parentName:"ul"},"Creating a link for the user to continue the process."),Object(s.b)("li",{parentName:"ul"},"Sending an email to the email address provided.")),Object(s.b)("p",null,"These actions should take place within the ",Object(s.b)("inlineCode",{parentName:"p"},"sendPasswordResetEmail")," executed by Linz."),Object(s.b)("h3",{id:"the-sendpasswordresetemail-static"},"The ",Object(s.b)("inlineCode",{parentName:"h3"},"sendPasswordResetEmail")," static"),Object(s.b)("p",null,"The ",Object(s.b)("inlineCode",{parentName:"p"},"sendPasswordResetEmail")," static should have the following signature:"),Object(s.b)("p",null,"function sendPasswordResetEmail (userEmail, req, res, callback)"),Object(s.b)("p",null,"It needs to be a ",Object(s.b)("a",Object(r.a)({parentName:"p"},{href:"https://mongoosejs.com/docs/guide.html#statics"}),"Mongoose static")," on your user model."),Object(s.b)("p",null,Object(s.b)("inlineCode",{parentName:"p"},"userEmail")," is the email address provided by the user who is trying to reset their password, ",Object(s.b)("inlineCode",{parentName:"p"},"req")," is the current request object, ",Object(s.b)("inlineCode",{parentName:"p"},"res")," is the current response object and ",Object(s.b)("inlineCode",{parentName:"p"},"callback")," is the function to execute when you've completed the neccessary steps."),Object(s.b)("p",null,"The ",Object(s.b)("inlineCode",{parentName:"p"},"callback")," accepts the standard Node.js signature:"),Object(s.b)("pre",null,Object(s.b)("code",Object(r.a)({parentName:"pre"},{className:"language-javascript"}),"function callback (err)\n")),Object(s.b)("p",null,"If an ",Object(s.b)("inlineCode",{parentName:"p"},"Error")," is provided, Linz will render the error, otherwise it will consider the process complete."),Object(s.b)("h3",{id:"retrieving-a-user-record-based-on-an-email-address"},"Retrieving a user record based on an email address"),Object(s.b)("p",null,"Use the ",Object(s.b)("inlineCode",{parentName:"p"},"userEmail")," argument to search your user model for a corresponding record. If a record can't be found, return an ",Object(s.b)("inlineCode",{parentName:"p"},"Error")," to the ",Object(s.b)("inlineCode",{parentName:"p"},"callback"),"."),Object(s.b)("p",null,"Make sure you take into consideration the following scenarios:"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"Multiple user records associated with the same email address."),Object(s.b)("li",{parentName:"ul"},"No user record associated with the email address.")),Object(s.b)("h3",{id:"genearing-a-unique-hash-for-the-user-record"},"Genearing a unique hash for the user record"),Object(s.b)("p",null,"Once you have the user record, generate a unique hash for the user record. We recommend including the ",Object(s.b)("inlineCode",{parentName:"p"},"username"),", ",Object(s.b)("inlineCode",{parentName:"p"},"_id"),", ",Object(s.b)("inlineCode",{parentName:"p"},"email")," and ",Object(s.b)("inlineCode",{parentName:"p"},"dateModified"),"."),Object(s.b)("p",null,"The hash you generate must be verifyable by generating the same hash, at a later time, with the same information in the database (i.e. ",Object(s.b)("inlineCode",{parentName:"p"},"username"),", ",Object(s.b)("inlineCode",{parentName:"p"},"_id"),", ",Object(s.b)("inlineCode",{parentName:"p"},"email")," and ",Object(s.b)("inlineCode",{parentName:"p"},"dateModified"),")."),Object(s.b)("p",null,"A good Node.js package to consider to generate a hash is the ",Object(s.b)("a",Object(r.a)({parentName:"p"},{href:"https://www.npmjs.com/package/bcryptjs"}),"bcrypt.js")," package."),Object(s.b)("h3",{id:"creating-a-link-to-verify-email-address-ownership"},"Creating a link to verify email address ownership"),Object(s.b)("p",null,"Once you have the unique hash, and the records ",Object(s.b)("inlineCode",{parentName:"p"},"_id")," value you can use ",Object(s.b)("inlineCode",{parentName:"p"},"linz.api.url.getAdminPasswordResetLink(id, hash)")," to generate a url. Pass in the ",Object(s.b)("inlineCode",{parentName:"p"},"_id")," and hash and Linz will safely add those to the url it returns."),Object(s.b)("h3",{id:"send-an-email"},"Send an email"),Object(s.b)("p",null,"Once you have the link, you simply need to send it to the email address with instructions on what to do next; click on the link."),Object(s.b)("p",null,"This is something you'll have to implement yourself. Linz does not provide any capabilities to send emails. Linz is based on Express though, so you have all of it's templating capabilities at hand. See ",Object(s.b)("a",Object(r.a)({parentName:"p"},{href:"https://expressjs.com/en/guide/using-template-engines.html"}),"using template engines with Express"),"."),Object(s.b)("h2",{id:"verifying-ownership-of-the-email-address"},"Verifying ownership of the email address"),Object(s.b)("p",null,"This part of the process involves verifying ownership of the email address. The user will receive the email, and click on the link. We want to make sure the link hasn't been tampered with and that we can generate the same hash that was provided in the link."),Object(s.b)("p",null,"Linz will retrieve the hash from the url and pass it to the ",Object(s.b)("inlineCode",{parentName:"p"},"verifyPasswordResetHash")," method."),Object(s.b)("p",null,"It must be a ",Object(s.b)("a",Object(r.a)({parentName:"p"},{href:"https://mongoosejs.com/docs/guide.html#methods"}),"Mongoose method")," on your user model."),Object(s.b)("p",null,"Your ",Object(s.b)("inlineCode",{parentName:"p"},"verifyPasswordResetHash")," Mongoose method should have the following signature:"),Object(s.b)("pre",null,Object(s.b)("code",Object(r.a)({parentName:"pre"},{className:"language-javascript"}),"function verifyPasswordResetHash (candidateHash, callback)\n")),Object(s.b)("p",null,"The ",Object(s.b)("inlineCode",{parentName:"p"},"candidateHash")," is the hash value that was retreived from the Url. The ",Object(s.b)("inlineCode",{parentName:"p"},"callback")," is a standard Node.js callback:"),Object(s.b)("pre",null,Object(s.b)("code",Object(r.a)({parentName:"pre"},{className:"language-javascript"}),"function callback (err, result)\n")),Object(s.b)("p",null,"The ",Object(s.b)("inlineCode",{parentName:"p"},"result")," should be a boolean value."),Object(s.b)("p",null,"Your ",Object(s.b)("inlineCode",{parentName:"p"},"verifyPasswordResetHash")," method should go through the same process to create the hash as it did in the first process. It should then verify that the ",Object(s.b)("inlineCode",{parentName:"p"},"candidateHash")," is the same as your freshly generated hash using the data from your database."),Object(s.b)("p",null,"If the ",Object(s.b)("inlineCode",{parentName:"p"},"candidateHash")," checks out and you can successfully match it, return ",Object(s.b)("inlineCode",{parentName:"p"},"true")," to the callback."),Object(s.b)("h2",{id:"updating-the-users-password"},"Updating the users password"),Object(s.b)("p",null,"If the ",Object(s.b)("inlineCode",{parentName:"p"},"hash")," was verified, the user is provided an opportunity to enter a new password. The new password must meet the requirements of the ",Object(s.b)("inlineCode",{parentName:"p"},"admin password")," setting."),Object(s.b)("p",null,"The new password is provided to the ",Object(s.b)("inlineCode",{parentName:"p"},"updatePassword")," ",Object(s.b)("a",Object(r.a)({parentName:"p"},{href:"https://mongoosejs.com/docs/guide.html#statics"}),"Mongoose static")," on your user model. The ",Object(s.b)("inlineCode",{parentName:"p"},"updatePassword")," static should have the following signature:"),Object(s.b)("pre",null,Object(s.b)("code",Object(r.a)({parentName:"pre"},{className:"language-javascript"}),"function updatePassword (id, newPassword, req, res, callback)\n")),Object(s.b)("p",null,Object(s.b)("inlineCode",{parentName:"p"},"id")," is the ",Object(s.b)("inlineCode",{parentName:"p"},"_id")," of the user model record. ",Object(s.b)("inlineCode",{parentName:"p"},"newPassword")," is the new password provided by the user. ",Object(s.b)("inlineCode",{parentName:"p"},"req")," is the current request object. ",Object(s.b)("inlineCode",{parentName:"p"},"res")," is the current response object. ",Object(s.b)("inlineCode",{parentName:"p"},"callback")," is a standard Node.js callback:"),Object(s.b)("pre",null,Object(s.b)("code",Object(r.a)({parentName:"pre"},{className:"language-javascript"}),"function callback (err)\n")),Object(s.b)("p",null,"If an ",Object(s.b)("inlineCode",{parentName:"p"},"Error")," is provided, Linz will render the error, otherwise it will consider the process complete."),Object(s.b)("p",null,"The user will be notified that their password has been updated, and prompted to log into Linz again."))}d.isMDXComponent=!0},92:function(e,t,a){"use strict";a.d(t,"a",(function(){return p})),a.d(t,"b",(function(){return h}));var r=a(0),n=a.n(r);function s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){s(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},s=Object.keys(e);for(r=0;r<s.length;r++)a=s[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)a=s[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var c=n.a.createContext({}),d=function(e){var t=n.a.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},p=function(e){var t=d(e.components);return n.a.createElement(c.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return n.a.createElement(n.a.Fragment,{},t)}},u=n.a.forwardRef((function(e,t){var a=e.components,r=e.mdxType,s=e.originalType,i=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=d(a),u=r,h=p["".concat(i,".").concat(u)]||p[u]||b[u]||s;return a?n.a.createElement(h,o(o({ref:t},c),{},{components:a})):n.a.createElement(h,o({ref:t},c))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=a.length,i=new Array(s);i[0]=u;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var c=2;c<s;c++)i[c]=a[c];return n.a.createElement.apply(null,i)}return n.a.createElement.apply(null,a)}u.displayName="MDXCreateElement"}}]);