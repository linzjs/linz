(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{81:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return r})),n.d(t,"rightToc",(function(){return s})),n.d(t,"default",(function(){return b}));var l=n(3),i=n(7),a=(n(0),n(92)),o={id:"models",title:"Models",sidebar_label:"Models"},r={unversionedId:"models",id:"models",isDocsHomePage:!1,title:"Models",description:"One of the primary reasons to use Linz is to ease model development and scaffold highly customizable interfaces for managing these models. Linz provides a simple DSL you can use to describe your model. Using the content of your DSL, Linz will scaffold an index, overview, edit handlers and provide a basic CRUD HTTP API for your model.",source:"@site/docs/models.md",slug:"/models",permalink:"/linz/docs/models",editUrl:"https://github.com/linzjs/linz/tree/master/docusaurus/docs/models.md",version:"current",sidebar_label:"Models",sidebar:"sidebar",previous:{title:"Linz defaults",permalink:"/linz/docs/linz-defaults"},next:{title:"Permissions",permalink:"/linz/docs/permissions"}},s=[{value:"Mongoose schemas",id:"mongoose-schemas",children:[]},{value:"Model DSL",id:"model-dsl",children:[]},{value:"Models model DSL",id:"models-model-dsl",children:[]},{value:"Models label DSL",id:"models-label-dsl",children:[]},{value:"Models list DSL",id:"models-list-dsl",children:[]},{value:"Models list DSL function",id:"models-list-dsl-function",children:[]},{value:"Models form DSL",id:"models-form-dsl",children:[]},{value:"Models form DSL function",id:"models-form-dsl-function",children:[{value:"Model permissions",id:"model-permissions",children:[]}]},{value:"Model statics, virtuals and methods",id:"model-statics-virtuals-and-methods",children:[{value:"listQuery static",id:"listquery-static",children:[]},{value:"canDelete method",id:"candelete-method",children:[]},{value:"canEdit method",id:"canedit-method",children:[]}]}],c={rightToc:s};function b(e){var t=e.components,n=Object(i.a)(e,["components"]);return Object(a.b)("wrapper",Object(l.a)({},c,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("p",null,"One of the primary reasons to use Linz is to ease model development and scaffold highly customizable interfaces for managing these models. Linz provides a simple DSL you can use to describe your model. Using the content of your DSL, Linz will scaffold an index, overview, edit handlers and provide a basic CRUD HTTP API for your model."),Object(a.b)("p",null,"All Linz models are bootstrapped with two properties (created by Linz):"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"dateCreated")," with a label of ",Object(a.b)("em",{parentName:"li"},"Date created"),"."),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"dateModified")," with a label of ",Object(a.b)("em",{parentName:"li"},"Date modified"),".")),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},"Linz will display your models in a list. The label used for each record is derived from the title field, or a virtual title field if one does not exist in your schema.\nIf your model has a title field, you don't have to do anything. If your model doesn't have a title field, you can tell Linz about another field in the schema that you would like used to derive a value and label for each record. The title is the default way to reference a record within Linz.")),Object(a.b)("p",null,"You create Models in the ",Object(a.b)("inlineCode",{parentName:"p"},"model")," directory; one file per model. The file should have the following basic structure:"),Object(a.b)("pre",null,Object(a.b)("code",Object(l.a)({parentName:"pre"},{className:"language-javascript"}),"var linz = require('linz');\n\n// Create a new mongoose schema.\nvar personSchema = new linz.mongoose.Schema({\n    name: String,\n    email: String,\n});\n\n// Add the Linz formtools plugin.\npersonSchema.plugin(linz.formtools.plugins.document, {\n    model: {\n        label: 'Person',\n        description: 'A person.',\n        title: 'name',\n    },\n    labels: {\n        name: 'Name',\n        email: 'Email',\n    },\n    list: {\n        fields: {\n            name: true,\n            email: true,\n        },\n    },\n    form: {\n        name: {\n            fieldset: 'Details',\n            helpText: 'The users full name.',\n        },\n        email: {\n            fieldset: 'Details',\n        },\n    },\n    overview: {\n        body: {\n            fields: ['name', 'email'],\n        },\n    },\n});\n\nvar person = (module.exports = linz.mongoose.model('person', personSchema));\n")),Object(a.b)("p",null,"The file is broken down in the following parts:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"You ",Object(a.b)("inlineCode",{parentName:"li"},"require")," Linz, as you'll need to register the model with Linz."),Object(a.b)("li",{parentName:"ul"},"Create a standard Mongoose schema."),Object(a.b)("li",{parentName:"ul"},"Use the ",Object(a.b)("inlineCode",{parentName:"li"},"linz.formtools.plugins.document")," Mongoose plugin to register the model with Linz, passing in an object containing Linz's model DSL."),Object(a.b)("li",{parentName:"ul"},"Create a Mongoose model from the schema, and ",Object(a.b)("inlineCode",{parentName:"li"},"export")," it.")),Object(a.b)("h2",{id:"mongoose-schemas"},"Mongoose schemas"),Object(a.b)("p",null,"Linz works directly with ",Object(a.b)("a",Object(l.a)({parentName:"p"},{href:"https://mongoosejs.com/docs/guide.html"}),"Mongoose schemas"),". Anything you can do with a Mongoose schema is acceptable to Linz."),Object(a.b)("h2",{id:"model-dsl"},"Model DSL"),Object(a.b)("p",null,"Linz uses a Model DSL, which is an object that can be used to describe your model. Linz will use this information to scaffold user interfaces for you. The Model DSL contains six main parts:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"model")," contains basic information such as the ",Object(a.b)("inlineCode",{parentName:"li"},"title")," field, ",Object(a.b)("inlineCode",{parentName:"li"},"label")," and ",Object(a.b)("inlineCode",{parentName:"li"},"description")," of the model."),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"labels")," contains human friendly versions of your model's properties, keyed by the property name."),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"list")," contains information used to scaffold the list displaying model records."),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"form")," contains information used to scaffold the edit handler for a model record."),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"overview")," contains information used to scaffold the overview for a model record."),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"fields")," contains directives to enable/disable fields that Linz automatically adds to models."),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"permissions")," is a function used to limit access to a model.")),Object(a.b)("p",null,"You supply the DSL to Linz in the form of an object, to the ",Object(a.b)("inlineCode",{parentName:"p"},"linz.formtools.plugins.document")," Mongoose plugin:"),Object(a.b)("pre",null,Object(a.b)("code",Object(l.a)({parentName:"pre"},{className:"language-javascript"}),"personSchema.plugin(linz.formtools.plugins.document, {\n    model: {\n        // ...\n    },\n    labels: {\n        // ...\n    },\n    list: {\n        // ...\n    },\n    form: {\n        // ...\n    },\n    overview: {\n        // ...\n    },\n    fields: {\n        // ...\n    },\n    permissions: function() {},\n});\n")),Object(a.b)("h2",{id:"models-model-dsl"},"Models model DSL"),Object(a.b)("p",null,"The ",Object(a.b)("inlineCode",{parentName:"p"},"model")," keys value should be an object with three keys:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"title")," is required, unless you have a ",Object(a.b)("inlineCode",{parentName:"li"},"title")," field in your schema. If not, you should reference another field in your schema. This field will be used to derive the ",Object(a.b)("em",{parentName:"li"},"title")," for the record, and label for the field."),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"label")," should be a singular noun describing the model."),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"description")," should be a short sentence describing the noun.")),Object(a.b)("p",null,"The ",Object(a.b)("inlineCode",{parentName:"p"},"label")," is used in many places and is automatically pluralized based on the usage context. The ",Object(a.b)("inlineCode",{parentName:"p"},"description")," is only used on the Models index within Linz."),Object(a.b)("p",null,"For example:"),Object(a.b)("pre",null,Object(a.b)("code",Object(l.a)({parentName:"pre"},{className:"language-javascript"}),"model: {\n    label: 'Person',\n    description: 'A person.',\n    title: 'name'\n}\n")),Object(a.b)("h2",{id:"models-label-dsl"},"Models label DSL"),Object(a.b)("p",null,"The label DSL is used to provide a label and description for the model."),Object(a.b)("p",null,"The ",Object(a.b)("inlineCode",{parentName:"p"},"labels")," keys value should be an object, keyed by field names and strings of the human friendly versions of your field names."),Object(a.b)("p",null,"For example:"),Object(a.b)("pre",null,Object(a.b)("code",Object(l.a)({parentName:"pre"},{className:"language-javascript"}),"labels: {\n    name: 'Name',\n    email: 'Email'\n}\n")),Object(a.b)("p",null,"You can customize the labels for the default ",Object(a.b)("inlineCode",{parentName:"p"},"dateModified")," and ",Object(a.b)("inlineCode",{parentName:"p"},"dateCreated")," using this object. You can also supply the key ",Object(a.b)("inlineCode",{parentName:"p"},"title")," with a value that should be used for the label of the record's title."),Object(a.b)("h2",{id:"models-list-dsl"},"Models list DSL"),Object(a.b)("p",null,"The list DSL is used to customize the model index that is generated for each model."),Object(a.b)("p",null,"The ",Object(a.b)("inlineCode",{parentName:"p"},"list")," keys value should be an Object, containing the following top-level keys:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"actions")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"fields")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"sortBy")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"toolbarItems")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"showSummary")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"filters")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"paging")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"groupActions")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"recordActions")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"export"))),Object(a.b)("p",null,"These allow you to describe how the model index should function. The list DSL is discussed in more detail in ",Object(a.b)("a",Object(l.a)({parentName:"p"},{href:"./list-dsl"}),"List DSL"),"."),Object(a.b)("h2",{id:"models-list-dsl-function"},"Models list DSL function"),Object(a.b)("p",null,"The ",Object(a.b)("inlineCode",{parentName:"p"},"list")," keys value can also be a function. It should be a function with the following signature:"),Object(a.b)("pre",null,Object(a.b)("code",Object(l.a)({parentName:"pre"},{className:"language-javascript"}),"function listDSL (req, callback) {\n")),Object(a.b)("p",null,"For example:"),Object(a.b)("pre",null,Object(a.b)("code",Object(l.a)({parentName:"pre"},{className:"language-javascript"}),"{\n    list: (req, callback) => callback(null, {\n        fields: {...}\n    })\n}\n")),Object(a.b)("p",null,"The function receives a HTTP request object, which provides lots of flexibility to alter the DSL object returned based on the user making the request, and the model record itself."),Object(a.b)("h2",{id:"models-form-dsl"},"Models form DSL"),Object(a.b)("p",null,"The form DSL is used to customize the model record create and edit pages."),Object(a.b)("p",null,"The ",Object(a.b)("inlineCode",{parentName:"p"},"form")," keys value should be an Object, keyed by field names of the model, in the order you'd like each field's edit control rendered. For example:"),Object(a.b)("pre",null,Object(a.b)("code",Object(l.a)({parentName:"pre"},{className:"language-javascript"}),"form: {\n    name: {\n        fieldset: 'Details',\n        helpText: 'The users full name.'\n    },\n    email: {\n        fieldset: 'Details'\n    }\n}\n")),Object(a.b)("p",null,"This will generate a form with two fields that you can provide data for. Both fields will appear in the ",Object(a.b)("em",{parentName:"p"},"Details")," fieldset, in the order ",Object(a.b)("inlineCode",{parentName:"p"},"name")," and then ",Object(a.b)("inlineCode",{parentName:"p"},"email"),"."),Object(a.b)("p",null,"Each field object can contain the following keys:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"label")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"placeholder")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"helpText")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"type")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"default")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"list")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"visible")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"disabled")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"fieldset")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"widget")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"required")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"query")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"transform")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"transpose")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"schema")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"relationship"))),Object(a.b)("p",null,"These allow you to describe how the create and edit forms should function. The form DSL is discussed in more detail in ",Object(a.b)("a",Object(l.a)({parentName:"p"},{href:"./form-dsl"}),"Form DSL"),"."),Object(a.b)("h2",{id:"models-form-dsl-function"},"Models form DSL function"),Object(a.b)("p",null,"The ",Object(a.b)("inlineCode",{parentName:"p"},"form")," keys value can also be a function. It should be a function with the following signature:"),Object(a.b)("pre",null,Object(a.b)("code",Object(l.a)({parentName:"pre"},{className:"language-javascript"}),"function formDSL(req, callback) {}\n")),Object(a.b)("p",null,"For example:"),Object(a.b)("pre",null,Object(a.b)("code",Object(l.a)({parentName:"pre"},{className:"language-javascript"}),"{\n    form: (req, callback) => callback(null, {\n        name: {...}\n    })\n}\n")),Object(a.b)("p",null,"The function receives a HTTP request object, which provides lots of flexibility to alter the DSL object returned based on the user making the request, and the model record itself."),Object(a.b)("h3",{id:"model-permissions"},"Model permissions"),Object(a.b)("p",null,"Model permissions is an in-depth topic and should be considered amongst other permission capabilities. Read more about ",Object(a.b)("a",Object(l.a)({parentName:"p"},{href:"./permissions"}),"permissions"),"."),Object(a.b)("h2",{id:"model-statics-virtuals-and-methods"},"Model statics, virtuals and methods"),Object(a.b)("p",null,"When working with models, Linz makes use of specific Mongoose statics, virtuals and methods if they've been provided."),Object(a.b)("p",null,"The following documents them, and their functionality."),Object(a.b)("h3",{id:"listquery-static"},"listQuery static"),Object(a.b)("p",null,"You can create a Mongoose static called ",Object(a.b)("inlineCode",{parentName:"p"},"listQuery")," for a model with the following signature:"),Object(a.b)("pre",null,Object(a.b)("code",Object(l.a)({parentName:"pre"},{className:"language-javascript"}),"function listQuery(req, query, callback) {}\n")),Object(a.b)("p",null,"If found, Linz will execute this function with ",Object(a.b)("inlineCode",{parentName:"p"},"req")," and a Mongoose query before executing it, when retrieving data for the model list view. This provides an opportunity to customise the query before execution."),Object(a.b)("p",null,"For example, if you'd like to return more fields from MongoDB than those listed in ",Object(a.b)("inlineCode",{parentName:"p"},"list.fields")," you can do it here:"),Object(a.b)("pre",null,Object(a.b)("code",Object(l.a)({parentName:"pre"},{className:"language-javascript"}),"model.static.listQuery = (req, query, callback) =>\n    callback(null, query.select('anotherField anotherOne'));\n")),Object(a.b)("h3",{id:"candelete-method"},"canDelete method"),Object(a.b)("p",null,"You can create a Mongoose method called ",Object(a.b)("inlineCode",{parentName:"p"},"canDelete")," for a model, with the following signature:"),Object(a.b)("pre",null,Object(a.b)("code",Object(l.a)({parentName:"pre"},{className:"language-javascript"}),"function canDelete(req, callback) {}\n")),Object(a.b)("p",null,"If found, Linz will execute this function before rendering the Model index page. This provides an opportunity to customise the delete record action. Because it is a Mongoose method, inside the function ",Object(a.b)("inlineCode",{parentName:"p"},"this")," is scoped to the record itself."),Object(a.b)("p",null,"The callback has the following signature ",Object(a.b)("inlineCode",{parentName:"p"},"callback (err, isEnabled, message)"),". ",Object(a.b)("inlineCode",{parentName:"p"},"isEnabled")," should be a boolean; ",Object(a.b)("inlineCode",{parentName:"p"},"true")," to enable the delete action, ",Object(a.b)("inlineCode",{parentName:"p"},"false")," to disable it. If it is disabled, you can use ",Object(a.b)("inlineCode",{parentName:"p"},"message")," to provide a message that will be displayed to the user if they click on the delete button."),Object(a.b)("h3",{id:"canedit-method"},"canEdit method"),Object(a.b)("p",null,"You can create a Mongoose method called ",Object(a.b)("inlineCode",{parentName:"p"},"canEdit")," for a model, with the following signature:"),Object(a.b)("pre",null,Object(a.b)("code",Object(l.a)({parentName:"pre"},{className:"language-javascript"}),"function canEdit(req, callback) {}\n")),Object(a.b)("p",null,"If found, Linz will execute this function before rendering the Model index page. This provides an opportunity to customise the edit record action. Because it is a Mongoose method, inside the function ",Object(a.b)("inlineCode",{parentName:"p"},"this")," is scoped to the record itself."),Object(a.b)("p",null,"The callback has the following signature ",Object(a.b)("inlineCode",{parentName:"p"},"callback (err, isEnabled, message)"),". ",Object(a.b)("inlineCode",{parentName:"p"},"isEnabled")," should be a boolean; ",Object(a.b)("inlineCode",{parentName:"p"},"true")," to enable the edit action, ",Object(a.b)("inlineCode",{parentName:"p"},"false")," to disable it. If it is disabled, you can use ",Object(a.b)("inlineCode",{parentName:"p"},"message")," to provide a message that will be displayed to the user if they click on the edit button."))}b.isMDXComponent=!0},92:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return p}));var l=n(0),i=n.n(l);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,l)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,l,i=function(e,t){if(null==e)return{};var n,l,i={},a=Object.keys(e);for(l=0;l<a.length;l++)n=a[l],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(l=0;l<a.length;l++)n=a[l],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=i.a.createContext({}),b=function(e){var t=i.a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=b(e.components);return i.a.createElement(c.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},u=i.a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,a=e.originalType,o=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=b(n),u=l,p=d["".concat(o,".").concat(u)]||d[u]||m[u]||a;return n?i.a.createElement(p,r(r({ref:t},c),{},{components:n})):i.a.createElement(p,r({ref:t},c))}));function p(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var a=n.length,o=new Array(a);o[0]=u;var r={};for(var s in t)hasOwnProperty.call(t,s)&&(r[s]=t[s]);r.originalType=e,r.mdxType="string"==typeof e?e:l,o[1]=r;for(var c=2;c<a;c++)o[c]=n[c];return i.a.createElement.apply(null,o)}return i.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"}}]);